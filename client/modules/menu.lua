ESX.UI.Menu = {}
ESX.UI.Menu.RegisteredTypes = {}
ESX.UI.Menu.Opened = {}

local useEsxMenus = false

if useEsxMenus then
    function ESX.UI.Menu.RegisterType(type, open, close)
        ESX.UI.Menu.RegisteredTypes[type] = {
            open = open,
            close = close
        }
    end

    function ESX.UI.Menu.Open(type, namespace, name, data, submit, cancel, change, close)
        local menu = {}

        menu.type = type
        menu.namespace = namespace
        menu.name = name
        menu.data = data
        menu.submit = submit
        menu.cancel = cancel
        menu.change = change

        menu.close = function()
            ESX.UI.Menu.RegisteredTypes[type].close(namespace, name)

            for i = 1, #ESX.UI.Menu.Opened, 1 do
                if ESX.UI.Menu.Opened[i] then
                    if ESX.UI.Menu.Opened[i].type == type and ESX.UI.Menu.Opened[i].namespace == namespace and
                        ESX.UI.Menu.Opened[i].name == name then
                        ESX.UI.Menu.Opened[i] = nil
                    end
                end
            end

            if close then
                close()
            end
        end

        menu.update = function(query, newData)
            for i = 1, #menu.data.elements, 1 do
                local match = true

                for k, v in pairs(query) do
                    if menu.data.elements[i][k] ~= v then
                        match = false
                    end
                end

                if match then
                    for k, v in pairs(newData) do
                        menu.data.elements[i][k] = v
                    end
                end
            end
        end

        menu.refresh = function()
            ESX.UI.Menu.RegisteredTypes[type].open(namespace, name, menu.data)
        end

        menu.setElement = function(i, key, val)
            menu.data.elements[i][key] = val
        end

        menu.setElements = function(newElements)
            menu.data.elements = newElements
        end

        menu.setTitle = function(val)
            menu.data.title = val
        end

        menu.removeElement = function(query)
            for i = 1, #menu.data.elements, 1 do
                for k, v in pairs(query) do
                    if menu.data.elements[i] then
                        if menu.data.elements[i][k] == v then
                            table.remove(menu.data.elements, i)
                            break
                        end
                    end
                end
            end
        end

        ESX.UI.Menu.Opened[#ESX.UI.Menu.Opened + 1] = menu
        ESX.UI.Menu.RegisteredTypes[type].open(namespace, name, data)

        return menu
    end

    function ESX.UI.Menu.Close(type, namespace, name)
        for i = 1, #ESX.UI.Menu.Opened, 1 do
            if ESX.UI.Menu.Opened[i] then
                if ESX.UI.Menu.Opened[i].type == type and ESX.UI.Menu.Opened[i].namespace == namespace and
                    ESX.UI.Menu.Opened[i].name == name then
                    ESX.UI.Menu.Opened[i].close()
                    ESX.UI.Menu.Opened[i] = nil
                end
            end
        end
    end

    function ESX.UI.Menu.CloseAll()
        for i = 1, #ESX.UI.Menu.Opened, 1 do
            if ESX.UI.Menu.Opened[i] then
                ESX.UI.Menu.Opened[i].close()
                ESX.UI.Menu.Opened[i] = nil
            end
        end
    end

    function ESX.UI.Menu.GetOpened(type, namespace, name)
        for i = 1, #ESX.UI.Menu.Opened, 1 do
            if ESX.UI.Menu.Opened[i] then
                if ESX.UI.Menu.Opened[i].type == type and ESX.UI.Menu.Opened[i].namespace == namespace and
                    ESX.UI.Menu.Opened[i].name == name then
                    return ESX.UI.Menu.Opened[i]
                end
            end
        end
    end

    function ESX.UI.Menu.GetOpenedMenus()
        return ESX.UI.Menu.Opened
    end

    function ESX.UI.Menu.IsOpen(type, namespace, name)
        return ESX.UI.Menu.GetOpened(type, namespace, name) ~= nil
    end
end

function ESX.UI.Menu.RegisterType(type, open, close)
    ESX.UI.Menu.RegisteredTypes[type] = {
        open = open,
        close = close
    }
end
